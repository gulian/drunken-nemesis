<div ng-controller=accountDetailsController>

    <h2>{{account.name}}  <small>{{account.bank}} </small></h2>

    <table class="table">
        <tbody>
            <tr>
            <td>Forecast balance</td>
            <td ng-class="forecastBalance < 0 ? 'text-danger' : 'text-success'" >{{forecastBalance | currency:'€'}}</td>
            </tr>
            <tr>
            <td>Current balance</td>
            <td ng-class="balance < 0 ? 'text-danger' : 'text-success'" >{{balance | currency:'€'}}</td>
            </tr>
        </tbody>
    </table>

    <button class="btn" ng-click="startNewOperation()" ng-disabled="newOperationIsInProgress">New operation</button>
    <button ng-disabled='selectedOperationsCount <= 0' ng-click='checkSelected()' class="btn btn-success">
        Check <span ng-show="selectedOperationsCount>0">{{selectedOperationsCount}}</span><ng-pluralize count="selectedOperationsCount"
            when="{
                '0'    : ' operation',
                'one'  : ' operation',
                'other': ' operations'
            }"></ng-pluralize>
    </button>
    <button ng-disabled='selectedOperationsCount <= 0' ng-click='uncheckSelected()' class="btn btn-warning">
        Uncheck <span ng-show="selectedOperationsCount>0">{{selectedOperationsCount}}</span><ng-pluralize count="selectedOperationsCount"
            when="{
                '0'    : ' operation',
                'one'  : ' operation',
                'other': ' operations'
            }"></ng-pluralize></button>
    <button ng-disabled='selectedOperationsCount <= 0' ng-click='deleteSelected()' class="btn btn-danger">
        Delete <span ng-show="selectedOperationsCount>0">{{selectedOperationsCount}}</span><ng-pluralize count="selectedOperationsCount"
            when="{
                '0'    : ' operation',
                'one'  : ' operation',
                'other': ' operations'
            }"></ng-pluralize></button>

    <hr>
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th style="width: 10px;"> </th>
                    <th style="width: 20px;"><input type="checkbox" ng-model='allSelected' ng-change='updateSelected(true, false)'></th>
                    <th>Date</th>
                    <th>Label</th>
                    <th>Amount</th>
                    <th style="width: 40px;">Checked</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-show="newOperationIsInProgress">
                    <td ng-class="newOperation.amount < 0 ? 'danger' : 'success' "></td>
                    <td><button ng-click='postNewOperation()' class="btn btn-primary">+</button></td>
                    <td><input class="form-control" ng-model="newOperation.created" type="date"></td>
                    <td><input class="form-control" ng-model="newOperation.name"    type="text"></td>
                    <td ng-class="newOperation.amount < 0 ? 'text-danger' : 'text-success'" ><input class="form-control" ng-model="newOperation.amount"  type="number"></td>
                    <td class="text-center" ng-class=" !newOperation.checked ? 'warning' : 'default' " ><input ng-model="newOperation.checked" type="checkbox"></td>
                </tr>
                <tr ng-repeat="operation in account.operations | orderBy:'-created'" >

                    <td ng-class="operation.amount < 0 ? 'danger' : 'success' ">
                    </td>
                    <td>
                        <input type="checkbox" ng-model='operation.selected' ng-change='updateSelected(false, operation.selected)'>
                    </td>
                    <td ng-click="operation.selected = !operation.selected; updateSelected(false, operation.selected)">
                        {{operation.created | date:"dd/MM/yyyy"}}
                    </td>
                    <td ng-click="operation.selected = !operation.selected; updateSelected(false, operation.selected)">
                        {{operation.name}}
                    </td>
                    <td ng-class="operation.amount < 0 ? 'text-danger' : 'text-success'" ng-click="operation.selected = !operation.selected; updateSelected(false, operation.selected)" style="text-align:right">
                        {{operation.amount | currency:'€' }}
                    </td>
                    <td class="text-center" ng-class=" !operation.checked ? 'warning' : 'default' " ng-click="operation.checked = !operation.checked ;update(operation);">
                        <input type="checkbox" ng-model='operation.checked' ng-click='update(operation)'>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
